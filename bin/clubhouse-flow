#!/usr/bin/env python3

import json
from os import environ
from urllib.request import Request, urlopen

api_url = 'https://api.clubhouse.io/api/v1'
api_token = environ['CLUBHOUSE_API_TOKEN']

my_user_id = environ['CLUBHOUSE_MY_USER_ID']
workflow_doing = 500000015

search_my_current_cards = { 'owner_ids': [my_user_id], 'workflow_state_id': workflow_doing }
search_url = "{api_url}/stories/search?token={api_token}".format(api_url=api_url, api_token=api_token)

r = Request(search_url, data=json.dumps(search_my_current_cards).encode('utf8'), headers={ 'content-type': 'application/json' })
currently_doing = json.loads(urlopen(r).read().decode('utf8'))


#  print(currently_doing[0]['name'])
print("Select current card (Enter for none):");
for key, value in enumerate(currently_doing):
    print("{0}. {1}".format(key, value['name']))

current = input("Current:")
if current:
    print(currently_doing[int(current)]['id'])
